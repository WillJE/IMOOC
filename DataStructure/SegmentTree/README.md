> 上一章我们介绍了堆，这一章我们介绍一种新的树结构，线段树(区间树) Segment Tree

#### 经典的线段树问题-区间染色

有一面墙，长度为n，每次选择一段儿墙进行染色，m次操作后，我们可以看见多少种颜色? m次操作后，我们可以在[i, j]区间内看见多少种颜色?

这里的一段儿是一个区间，所以线段树主要解决的是关注区间的问题。

另一类经典问题: 区间查询，查询一个区间[i, j]的最大值，最小值，或者区间数字和.实质:基于区间的统计查询

例如: 2017年注册用户中消费最高的用户?消费最少的用户?学习时间最长的用户?某个太空区间中天体总量?

>这个查询也有可能是一个动态的查询，并不限定于2017年的历史数据，有可能2018年他还是在消费的，数据依然在不断的变化。天体从区间跑到另一个区间。

**也就是数据在不断的更新，我们也可以进行不断的查询。**


如果使用数组来完成上述问题，时间复杂度为O(n)，但是使用线段树只需要O(logn)。

#### 线段树的实现
首先，**对于线段树我们是没有对应的新增和删除操作的**，所以线段树针对的是一个已知长度的操作。

假如有一个长度为7的数组，我们的功能是求其区间的和，我们可以这样构造一个线段树。

首先在根节点是[0,7]的和，再分成两份，左子树[1,3]的和，右子树[4,7]的和，依次类推，我们就得到了下图这样的线段树。
![image](http://myphoto.mtianyan.cn/20180814141016_kmrRn4_Screenshot.jpeg)


#### 线段树的基础表示
对于当数组长度不能平均分的时候，就会出现如下图这种情况。
![image](http://myphoto.mtianyan.cn/20180814152110_pHh2lD_Screenshot.jpeg)

**所以线段树不是完全二叉树;但线段树是平衡二叉树**。

平衡二叉树的定义:

    最大的深度和最小的深度之差最多为1

如上图我们的叶子节点要么在深度为4的位置，要么在深度为5的位置。

平衡二叉树不会退化成链表，依然是log级别的。

此时我们考虑一个问题，**如果区间有n个元素数组表示需要有多少节点**?

由于线段树不一定是一个完全二叉树，但是我们可以将他看成一个完全二叉树，只不过他最后一层的空元素可以看成为null，所以根据完全二叉树的定义，我们只需要4n的静态空间就完全够了（这4n有可能一半都会浪费),但是由于现代计算机空间已经不是主要矛盾了，所以采用空间换时间的方式可取，但是这部分浪费是可以避免的，后面会讲到。

![image](http://myphoto.mtianyan.cn/20180814153051_3wcWF9_Screenshot.jpeg)

#### 更多与线段树相关话题
不参加算法竞赛，线段树不是一个重点。

线段树虽然不是一棵完全二叉树，但是可以看做是一棵满二叉树，进而使用数组来存储。这与之前讲的堆是一致的。

理解树这种结构，节点存储的内容表示的意义不一样，左右子树表示什么意思。赋予结构合理定义，高效处理特殊问题。

创建线段树，查询线段树，更新线段树。

递归之后，还要融合，实际是一种后序遍历的思想。


